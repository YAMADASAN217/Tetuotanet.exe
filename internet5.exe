name: Build Simple Browser EXE (PySide6 / 32-bit Final Attempt)

on:
  push:
    branches: [ main ]
  workflow_dispatch: # 手動実行も可能

jobs:
  build_windows:
    runs-on: windows-latest # Windows環境でビルド

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    # ----------------------------------------------------
    # ★最重要★ 32ビット Python (x86) の環境セットアップ
    # ----------------------------------------------------
    - name: Set up Python 3.11 (32-bit)
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        architecture: 'x86'    # これで32ビット環境が確定
    
    # ----------------------------------------------------
    # 依存関係のインストール (Nuitka + PySide6)
    # ----------------------------------------------------
    - name: Install dependencies (Nuitka + PySide6)
      run: |
        python -m pip install --upgrade pip
        # PySide6とWebEngine、そしてNuitkaをインストール
        pip install nuitka PySide6 PySide6-WebEngine
    
    # ----------------------------------------------------
    # NuitkaによるEXEファイルのビルド
    # ----------------------------------------------------
    - name: Build the EXE using Nuitka (PySide6 Plugin)
      # --standaloneと--onefileで一つの実行ファイルにまとめます
      # --plugin-enable=pyside6 でPySideの依存ファイルを確実に収集
      # --disable-console は、実行時に黒い画面を出さないようにするため
      run: |
        python -m nuitka --standalone --onefile --disable-console --plugin-enable=pyside6 browser.py
    
    # ----------------------------------------------------
    # 成果物のアップロード
    # ----------------------------------------------------
    - name: Upload the compiled EXE
      uses: actions/upload-artifact@v4
      with:
        name: SimpleBrowser-PySide6-32bit-Windows-EXE
        path: browser.exe
